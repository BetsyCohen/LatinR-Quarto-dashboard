---
title: "Tableros con Quarto Dashboards y Crosswalk"
author:
  - name: "Betsy Cohen"
    affiliations: 
    - name: "N√∫cleo de Innovaci√≥n Social"
    - name: "RLadies Buenos Aires"
date: "2024-12-01"
footer: "https://betsycohen.github.io/LatinR-Quarto-dashboard/"
logo: "images/logo-latinr.png"
format: 
  revealjs: 
    width: 1600
    height: 900  
    theme: slides.scss
    highlight-style: a11y
    transition: fade
    slide-number: true
execute:
  echo: true
df-print: kable
---

## Bienvenvidxs! 

Antes de arrancar asegurate de haber seguido las instrucciones de configuraci√≥n y que ten√©s los programas y paquetes que necesit√°s para seguir el taller. 

Si vas a seguir los ejrecicios deber√°s ingresar en  [https://betsycohen.github.io/LatinR-Quarto-dashboard/](https://betsycohen.github.io/LatinR-Quarto-dashboard/) y la [carpeta del ejercicio](https://betsycohen.github.io/quarto-dashboards-rladiesBA/exercises.zip) que contiene:

üìÅ datos

üìÅ imagenes

![](images/r-file.png) Archivos con ejercicios borrador y archivos de r con ejercicios resueltos



## Nuestra agenda para hoy

-   Layout

-   Value boxes y themes

-   Pausa üßâ

-   Crosstalk

-   Tiempo para preguntas


## Hola! Soy Betsy

![](images/betsy2.png){style="border-radius:1em;margin-top:auto"}



# 01. El Layout: Empecemos por el principio {.section-divider}

![](images/layout-sketch.png)

## La unidad fundamental en los tableros de Quarto son las tarjetas {auto-animate="true" auto-animate-easing="ease-in-out"}

::: r-hstack
::: {data-id="box1" auto-animate-delay="0" style="background: #72994E; width: 200px; height: 150px; margin: 10px; border: 3px solid #57733D;"}
:::

::: {data-id="box2" auto-animate-delay="0.1" style="background: #F2F2F2; width: 200px; height: 150px; margin: 10px; border: 3px solid #C2C2C4;"}
:::

::: {data-id="box3" auto-animate-delay="0.2" style="background: #419599; width: 200px; height: 150px; margin: 10px; border: 3px solid #297075;"}
:::
:::

## Por default las tarjetas se ordenan en **filas** y **columnas** {auto-animate="true" auto-animate-easing="ease-in-out"}

::: r-stack
::: {data-id="box1" auto-animate-delay="0" style="background: #72994E; width: 235px; height: 145px; margin-top: 30px; position: absolute; left: 550px; border: 3px solid #57733D;"}
:::

::: {data-id="box2" style="background: #F2F2F2; width: 235px; height: 145px; margin-top: 30px; position: absolute; right: 550px; border: 3px solid #C2C2C4;"}
:::

::: {data-id="box3" style="background: #419599; width: 500px; height: 300px; margin-top: 200px; border: 3px solid #297075;"}
:::
:::

## Y si queremos un layout m√°s avanzado vamos a poder agregar **p√°ginas**, **tabsets**, y **sidebars** {auto-animate="true" auto-animate-easing="ease-in-out"}

::: r-stack
::: {data-id="box1" auto-animate-delay="0" style="background: #72994E; width: 235px; height: 145px; margin-top: 30px; position: absolute; left: 550px; border: 3px solid #57733D;"}
:::

::: {data-id="box2" style="background: #F2F2F2; width: 235px; height: 145px; margin-top: 30px; position: absolute; right: 550px; border: 3px solid #C2C2C4;"}
:::

::: {data-id="box3" style="background: #419599; width: 500px; height: 300px; margin-top: 200px; border: 3px solid #297075;"}
:::

::: {data-id="box4" auto-animate-delay="0" style="background: #DFB33E; width: 150px; height: 470px; margin-top: 30px; position: absolute; right: 1070px; border: 3px solid #9a771a;"}
:::
:::

## Navegaci√≥n {.smaller}

Todos los tableros tienen una barra de navegaci√≥n superior o \`nav-bar\` a la que le podemos agregar desde YAML diferentes elementos como **botones de navegaci√≥n** (como links a linkedin, twitter) y **botones personalizados**

::: columns
::: {.column width="50%"}

``` {.yaml filename="dashboard-r.qmd"}
---
title: "Mi primer tablero en quarto"
format:
  dashboard:
    logo: images/rladies-hex.png
    nav-buttons: [linkedin,twitter,github]
---
```

:::
::: {.column width="50%"}
![](images/navigation-toolbar.png)
:::
:::

::: callout-tip
### M√°s data sobre navegaci√≥n

Para aprendar m√°s acreca del layout y controlar temas como la orientaci√≥n, scrolleo, etc. consulta [esta secci√≥n](https://quarto.org/docs/dashboards/layout.html#layout) de la docu
:::

## Trabajando la disposici√≥n {.smaller}
::: columns
::: {.column width="50%"}
Las filas y columnas se definen, a su vez, mediante encabezados de Markdown y chuncks. Por ejemplo, aqu√≠ se muestra un dise√±o simple con dos filas, donde la segunda fila se divide en dos columnas:

::: r-box
````{.yaml filename="dashboard-r.qmd"}
---
title: "Mi primer tablero en quarto"
format: dashboard
---

## Row {height=70%}

```{{r}}
``` 
## Row {height=30%}
```{{r}}
``` 
```{{r}}
``` 
````
:::

:::

::: {.column width="50%"}
![](images/chart-focal-top.png){height="700"}
:::

:::

## Paginado {.smaller}

Podemos agregar varias p√°ginas a nuestro dashboard usando t√≠tulos del nivel 1 de Markdown.

::: r-box
````{.yaml filename="dashboard-r.qmd"}
---
title: "Mi primer tablero en quarto"
format: dashboard
---

# Page 1

## Row {height=70%}

```{{r}}
``` 
## Row {height=30%}
```{{r}}
``` 
```{{r}}
``` 
# Page 2
```{{r}}
``` 
```{{r}}
``` 
````
:::

## Tabset {.smaller}
::: columns

::: {.column width="50%"}

Otra opci√≥n muy linda es agregar solapas o tabsets indicando la clase .tabset a una columna o fila:

::: r-box
````{.yaml filename="dashboard-r.qmd"}
---
title: "Mi primer tablero en quarto"
format: dashboard
---

## Row 

```{{r}}
``` 
## Row {.tabset}
```{{r}}
``` 
```{{r}}
``` 
````
:::

:::

::: {.column width="50%"}
![](images/chart-tabset-row.png){height="700"}
:::

:::

## Pasito a pasito: el layout en acci√≥n

![](images/Gilda.jpg){style="border-radius:1em;margin-top:auto"}

## Paso 1: Arm√° un archivo Quarto con `format: dashboard` en el YAML {auto-animate="true"}

::: r-box
```{.yaml filename="dashboard-r.qmd"}
---
title: "Mi primer tablero en quarto"
format: dashboard
---
```
:::

## Paso 2: Cada chunck funciona como una tarjeta {.smaller auto-animate="true"}

Los distintos niveles de las seccioines en que se ordenen esas tarjetas tambi√©n podemos irlas agregando usando \##

::: r-box
````{.yaml filename="dashboard-r.qmd" code-line-numbers="|10-13"}
---
title: "Mi primer tablero en quarto"
format: dashboard
---

```{{r}}
library(ggplot2)
```

```{{r}}
ggplot(mpg, aes(x = cty, y = hwy)) +
  geom_point()
```
````
:::

## Paso 2: As√≠ queda nuestra primera tarjeta {.smaller auto-animate="true"}

::: columns
::: {.column width="40%"}
::: r-box
````{.yaml filename="dashboard-r.qmd"}
---
title: "Mi primer tablero en quarto"
format: dashboard
---

```{{r}}
library(ggplot2)
```

```{{r}}
ggplot(mpg, aes(x = cty, y = hwy)) +
  geom_point()
```
````
:::
:::

::: {.column width="60%"}
![](images/first-dashboard-r-1.png)
:::
:::

## Paso 3: Sumamos otra tarjeta {.smaller auto-animate="true"}

::: r-box
````{.yaml filename="dashboard-r.qmd" code-line-numbers="|15-18"}
---
title: "Mi primer tablero en quarto"
format: dashboard
---

```{{r}}
library(ggplot2)
```

```{{r}}
ggplot(mpg, aes(x = cty, y = hwy)) +
  geom_point()
```

```{{r}}
ggplot(mpg, aes(x = drv)) +
  geom_bar()
```
````
:::

## Paso 3: Y se visualiza abajo {.smaller auto-animate="true"}

::: columns
::: {.column width="40%"}
::: r-box
````{.yaml filename="dashboard-r.qmd"}
---
title: "Mi primer tablero en quarto"
format: dashboard
---

```{{r}}
library(ggplot2)
```

```{{r}}
ggplot(mpg, aes(x = cty, y = hwy)) +
  geom_point()
```

```{{r}}
ggplot(mpg, aes(x = drv)) +
  geom_bar()
```
````
:::
:::

::: {.column width="60%"}
![](images/first-dashboard-r-2.png)
:::
:::

## Paso 4: A cada tarjeta podemos agregarle un t√≠tulo usando la opci√≥n `#|title:` {.smaller auto-animate="true"}

::: r-box
````{.yaml filename="dashboard-r.qmd" code-line-numbers="|11,17"}
---
title: "Mi primer tablero en quarto"
format: dashboard
---

```{{r}}
library(ggplot2)
```
```{{r}}
#| title: Highway vs. city mileage
ggplot(mpg, aes(x = cty, y = hwy)) +
  geom_point()
```
```{{r}}
#| title: Drive types
ggplot(mpg, aes(x = drv)) +
  geom_bar()
```
````
:::

## Paso 4: A cada tarjeta podemos agregarle un t√≠tulo usando la opci√≥n `#|title:` {.smaller auto-animate="true"}

::: columns
::: {.column width="40%"}
::: r-box
````{.yaml filename="dashboard-r.qmd"}
---
title: "Mi primer tablero en quarto"
format: dashboard
---

```{{r}}
library(ggplot2)
```
```{{r}}
#| title: Highway vs. city mileage
ggplot(mpg, aes(x = cty, y = hwy)) +
  geom_point()
```
```{{r}}
#| title: Drive types
ggplot(mpg, aes(x = drv)) +
  geom_bar()
```
````
:::
:::

::: {.column width="60%"}
![](images/first-dashboard-r-3.png)
:::
:::

## Ejercicio 1: Layout {.smaller}

Vamos a trabajar con un ranking de los libros m√°s vendidos creando un dashboard con tres tarjetas. 

En la [carpeta del ejercicio](https://betsycohen.github.io/quarto-dashboards-rladiesBA/exercises.zip) ya tenemos listo un primer borrador con el c√≥digo para visualizar una tabla y dos gr√°ficos hechos con `plotly{}`. 

<br>

**Si por alguna raz√≥n no pudiste descargar el archivo tambi√©n podes copiar el c√≥digo de la pr√≥xima diapo de esta presentaci√≥n.**


#### ¬°A trabajar!

<br>

::: tu-turno-box
1.   Cre√° un proyecto Quarto setendo el formato como dashboard
2.   Indic√° un t√≠tulo en YAML
3.   En un primer chunck de setup llam√° a las librer√≠as `tidyverse`, `dt` y `plotly` y carga los datos de libros.
4.   A cada tarjeta asignales t√≠tulos usando la opci√≥n `#| title:`
5.   Setea las dos √∫ltimas tarjetas como tabs usando `{.tabset}` en la definici√≥n del nivel de la fila.
:::

{{< countdown minutes=15 >}}

## Por si necesitas Copiar y pegar las visualizaciones {.smaller}

::: r-box
````{.yaml filename="dashboard-r.qmd"}

```{{r}}
# Tabla en DT con libros

datatable(
  libros,
  options = list(
    pageLength = 10,
    order = list(list(0, 'asc')), # ordenamos la tabla por ranking
    dom = 'ftp',                  # solo filtro arriba (f), tabla (t) y paginaci√≥n (p)
    language = list(
      searchPlaceholder = "Buscar...",
      search = "" # saca el texto de 'Search:'
    )
  ),
  class = 'table table-striped table-hover table-sm', # usamos Bootstrap 
  filter = "none",   # sin filtros en columnas
  rownames = FALSE,
  colnames = c("Puesto","T√≠tulo","Autor√≠a","$AR","Stock","Puntaje","G√©nero","P√°g.","Ebook")
)

```

```{{r}}
# Grafico 1 barplot raiting promedio por g√©nero
plot_ly(
  data = libros,
  x    = ~genero,
  y    = ~rating,
  type = "bar",
  transforms = list(list(
    type = "aggregate",
    groups = ~genero,
    aggregations = list(
      list(target = "y", func = "avg", enabled = TRUE)
    )
  )),
  marker = list(color = colores),
  showlegend = FALSE
)
```

```{{r}}
# Gr√°fico 2 boxplot de precios por g√©nero
plot_ly(
  data = libros,
  x    = ~genero,
  y    = ~precio,
  color = ~genero,
  colors = colores,
  type  = "box",
  boxpoints = "outliers",
  showlegend = FALSE
) %>%
  layout(
    xaxis = list(title = ""),
    yaxis = list(title = "Precio $AR")
  )
```
````
:::


## Cuando termines deberias tener algo as√≠ {.smaller}

<iframe 
  src="dashboards/ejemplo1.html"
  width="100%" 
  height="700" 
  style="border: none;">
</iframe>

:::
:::

# 02. Las Value Boxes y themes {.section-divider}

![](images/value-boxes.png)

## Qu√© son las Value boxes

-   Las value boxes son un tipo de tarjeta especial que sirve para llevar la ateci√≥n a alguna medida de resumen espec√≠fica o valor de referencia.
-   Podes crear value boxes en alguna celda especifica o como divs en el markdown
-   Las value boxes usan √≠conos de Bootstrap y les podemos setaar color (por ej con c√≥digos HEX) o si usaste un alias de color como parte de tu scss (no llegamos a ver este tema en esta presenta üòû)

## Paso 1: definimos los valores {.smaller}

::: r-box
````{.yaml filename="dashboard-r.qmd"}
---
title: "Valueboxes"
format: dashboard
---

```{{r}}
library(ggplot2)
library(dplyr)
```
## Value boxes {height="25%"}
```{{r}}
#| label: calculate-values
lowest_mileage_cty <- mpg |>
  filter(cty == min(cty)) |>
  distinct(cty) |>
  pull(cty)

highest_mileage_cty <- mpg |>
  filter(cty == max(cty)) |>
  distinct(cty) |>
  pull(cty)
  
rounded_mean_city_mileage <- mpg |>
  summarize(round(mean(cty), 2)) |>
  pull()
```
````
:::

## Paso 2: hacemos los value en cuestion {.smaller}

Usamos las opciones:

`#| content: valuebox`

`#| icon: nombre-del-icono`

`#| color: nombre o hex del color`

Tambi√©n es recomendable que seteemos la opci√≥n `#| expandable: false` (ya que no tiene sentido expandir estos elementos.) y que le pongamos un alto a esa fila de no m√°s del 30%

::: r-boxes
````{.yaml filename="dashboard-r.qmd"}
```{{r}}
#| content: valuebox
#| title: "Un t√≠tulo"
#| icon: fuel-pump-fill
#| color: danger
#| expandable: false

paste(lowest_mileage_cty, "mpg")
```
````
:::

## Hermoseando con Themes

Como en otras publicaciones de Quarto podemos tunear los themes (usando scss) o los mismos que ya vienen cargados de Bootstrap as√≠ como agregar logos en el slider superior. Todas cosas que podemos hacer desde el YAML

::: r-boxes
``` {.yaml filename="dashboard-r.qmd"}
---
title: "Tablero de libros"
format: dashboard
theme: minty
logo: "images/logo.png"
editor: source
---
```
:::

## Ejercicio 2: value boxes y themes {.smaller}

Vamos a tomar **10 minutos** y poner manos a la obra:

::: tu-turno-box
-   Agreg√° tres value boxes indicando precio promedio, raiting promedio y porcentaje de libros que son ebook Usar los iconos "cash","star" y "phone" correspondientemente.
-   Cambia el theme del dashboard a uno de tu elecci√≥n (por ej. minty) y agreg√° la imagen "images/logo.png" como logo desde YAML
:::

{{< countdown minutes=10 >}}

::: {.callout-tip collapse="true"}
Podes copiar el c√°lculo de los value boxes de aqu√≠

::: r-box
```{.yaml filename="dashboard-r.qmd"}
#| label: calculo de elementos para value-boxes

## precio promedio
precio_prom <- libros %>%
  filter(stock == "Disponible") %>%
  summarise(promedio = mean(precio, na.rm = TRUE)) %>%
  pull(promedio)

## puntaje promedio
rating_prom <- libros %>%
  filter(stock == "Disponible") %>%
  summarise(promedio = mean(rating, na.rm = TRUE)) %>%
  pull(promedio)

## porcentaje de libros en digital
pct_ebook <- libros %>%
  summarise(pct = mean(ebook == "S√≠", na.rm = TRUE)*100) %>%
  pull(pct)
```
:::
:::

## Cuando termines deberias tener algo as√≠ {.smaller}

<iframe 
  src="dashboards/ejemplo3.html"
  width="100%" 
  height="700" 
  style="border: none;">
</iframe>


# Nos tomamos 5 y volvemos. {.section-divider}
![](images/breake-time.gif)


{{< countdown minutes=5 >}}


# 03. Crosstalk para un poquito de interactividad {.section-divider}

![](images/crosstalk-section.gif)

## ¬øQu√© es crostalk?

-   Crosstalk facilita la vinculaci√≥n de m√∫ltiples widgets HTML dentro de una p√°gina R Markdown, un tablero de Quarto o una aplicaci√≥n Shiny.

-   La API principal de Crosstalk es un tipo de objeto llamado SharedData que encapsula el dataframe y lo pasa al widget que querramos usar.

-   Con Crosstalk vamos a poder laburar con widgets como `plotly()`, `leaflet()` o `dt()`

-   Adem√°s algunos autores han agregado otros paquetes compatibles como `SummaryWidget()` de Kent Johnson o `kpiwidget()` de Arnold Kakas (que vamos a ver en seguida).

## Filtros en crosstalk {.smaller}

Crosstalk tambi√©n admite el uso de filtros (parecidos a los que tenemos en shiny), pero con la ventaja de que estamos trabajando con un html est√°tico.

```{r}
#| label: ejemplo-filtros-crosstalk
#| output-location: slide
#| echo: true
#| warning: false

library(crosstalk)
library(plotly)

# Creamos un nuveo objeto compartido
shared_mtcars <- SharedData$new(mtcars)

bscols( # lo ordeno en columnas
  widths = c(3, NA, NA),
  
  # Filtros interactivos en fomrato lista
  list(
    filter_checkbox("cyl", "Cilindros", shared_mtcars, ~cyl, inline = TRUE),
    filter_slider("hp", "Caballos", shared_mtcars, ~hp, width = "100%"),
    filter_select("auto", "Automatico", shared_mtcars, ~ifelse(am == 0, "Yes", "No"))
  ),
  
  # Primer gr√°fico plotly 
  plot_ly(shared_mtcars, x = ~wt, y = ~mpg, color = ~factor(cyl),
          type = "scatter", mode = "markers") %>%
    layout(xaxis = list(title = "Peso"),
           yaxis = list(title = "Millas por gal√≥n")),
  
  # Segundo gr√°fico plotly 
  plot_ly(shared_mtcars, x = ~hp, y = ~qsec, color = ~factor(cyl),
          type = "scatter", mode = "markers") %>%
    layout(xaxis = list(title = "Caballos"),
           yaxis = list(title = "1/4 milla"))
)
```

## El paquete `kpiwidget` {.smaller}

-   `kpiwidget()` (y su funci√≥n homonima) nos permite crear indicadores clave de rendimiento (KPI) en los paneles de Quarto con crosstalk.

-   Podemos hacer una serie de datos resumen s√≠mples como sumas, promedios, minimos y m√°ximos as√≠ ratios o el share de un determinado segmento.

Veamos un uso b√°sico ...

::: r-boxes
```{.yaml filename="dashboard-r.qmd"}

# cargamos las librer√≠as
library(crosstalk)
library(kpiwidget)

# Envolvemos nuestra base en SharedData:
sd <- SharedData$new(mtcars)

# Mostramos el promnedio de la variable mpg (millas por gal√≥n) para autos de 4 cilindros.
kpiwidget(sd, 
          kpi = "mean", 
          column = "mpg",
          selection = ~ cyl == 4
          )
```
:::

## Ejerecicio 3: agregando interactividad con crosstalk...{.smaller}

::: tu-turno-box
-   **Paso 1:** Vamos a cambiar un poco el layout pasando a dos columnas: una la vamos a usar como sidebar para los filtros y otra la vamos a mentener como cuerpo de nuestro

-   **Paso 2:** Creamos el objeto compartido `shared_libros` con `ShareData$new` de CrossTalk a partir de nuestra tabla de libros

-   **Paso 3:** En el sidebar de filtros creamos tres tarjetas con los filtros usando las funciones as√≠:

::: r-boxes
````{.yaml filename="dashboard-r.qmd"}
## Filters {.sidebar}

```{{r}}
#| label: filtro-generos
filter_select("filtro_genero", "G√©nero", shared_libros, ~genero, multiple = TRUE)
```
```{{r}}
#| label: filtro-precio
filter_slider("filtro_precio", "Precio (ARS)", shared_libros, ~precio, width = "100%")
```
```{{r}}
#| label: filtro-ebook
filter_checkbox("filtro_ebook", "Disponible en Ebook", shared_libros, ~ebook, inline = TRUE)
```
````
:::

-   **Paso4:**: En los gr√°ficos vamos a reemplazar la tabla libros por shared_libros
:::

{{< countdown minutes=15 >}}



## Cuando termines deberias tener algo as√≠ {.smaller}

<iframe 
  src="dashboards/ejemplo4.html"
  width="100%" 
  height="700" 
  style="border: none;">
</iframe>



## Publicaci√≥n y exportaci√≥n:

- Como un html stand alone usando la opci√≥n `embed-resources: true` en tu yaml, ideal si es de circulaci√≥n interna o lo queres embeber en otro lado tipo iframe

- Con el comando `quarto publish` en cualquiera de los [servicios disponibles](https://quarto.org/docs/dashboards/deployment.html#static-dashboards) o via integraci√≥n cont√≠nua, pero ojo que despu√©s quedan p√∫blicos. 

En ese caso te recomiendo ver [este tutorial](https://youtu.be/5zYrgRylkH0?si=N5PIJdi5qPxMOmDT) de [Melissa Van Bussel](https://github.com/melissavanbussel) sobre publicaci√≥n de dahboards con GitHub Actions

- Quarto Dahboards tambi√©n permite integrar herramientas de shiny, pero en ese caso ya vas a necesitar deployar en un servidor como shiny server (open source) o posit connect (comercial). M√°s sobre ese tema [aqu√≠](https://quarto.org/docs/dashboards/deployment.html#shiny-dashboards)


## ¬øPreguntas/ comentarios?

![](images/questions.gif)

# ¬°Muchas gracias!

{{< fa brands linkedin >}} [\@betsabe1984](https://www.linkedin.com/in/betsabe1984/)\
{{< fa mail >}} [betsabecohen@gmail.com](mailito:betsabecohen@gmail.com)
